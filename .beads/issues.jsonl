{"id":"ArcataAI-0cn","title":"Job URL Submission Flow - End-to-end integration","description":"Epic: Connect HQ UI to Scala API for job URL submission. User submits URL -\u003e API processes via ETL pipeline -\u003e job appears in stream/tracker. Includes: API client, route action, notifications, side panel, data revalidation.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-22T19:00:46.272951981-05:00","updated_at":"2025-12-22T21:58:02.225701242-05:00","closed_at":"2025-12-22T21:58:02.225701242-05:00"}
{"id":"ArcataAI-0cn.1","title":"Add VITE_API_URL environment variable","description":"Add VITE_API_URL to apps/hq environment config. Default: http://localhost:4203 for local dev. Update .env.example at root with this new variable. This enables the HQ frontend to call the Scala API.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:00:54.918743025-05:00","updated_at":"2025-12-22T20:23:58.524224551-05:00","closed_at":"2025-12-22T20:23:58.524224551-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.1","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:00:54.919422872-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.10","title":"Add WebSocket client for job ingestion in HQ app","description":"Create WebSocket client in apps/hq/src/lib/api.ts\n\nTypes:\ninterface ProgressUpdate {\n  step: number;\n  totalSteps: number;  // Dynamic: 7 for new, 3 for existing\n  status: 'checking' | 'fetching' | 'parsing' | 'resolving' | 'loading' | 'streaming' | 'tracking' | 'complete' | 'error';\n  message: string;\n  jobId?: number;\n  streamId?: number;\n  applicationId?: number;\n  error?: string;\n}\n\nFunction:\ningestJobWithProgress(\n  request: IngestJobRequest,\n  token: string,\n  onProgress: (update: ProgressUpdate) =\u003e void\n): Promise\u003cIngestJobResult\u003e\n\nImplementation:\n1. Build WS URL: http-\u003ews, https-\u003ewss conversion\n2. Connect to ${wsUrl}/api/v1/jobs/ingest/ws?token=${token}\n3. On open: send request as JSON\n4. On message: parse ProgressUpdate, call onProgress\n   - UI uses totalSteps to know how many dots to render\n5. On 'complete': resolve promise with success data\n6. On 'error': resolve promise with error data\n7. 5 minute timeout - reject if no complete/error received\n8. Clean up WebSocket on completion\n\nKeep REST ingestJob() function as fallback (not used in this flow but available).","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:40:43.550323531-05:00","updated_at":"2025-12-22T21:55:15.292326077-05:00","closed_at":"2025-12-22T21:55:15.292326077-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.10","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:40:43.551053073-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.10","depends_on_id":"ArcataAI-0cn.9","type":"blocks","created_at":"2025-12-22T19:41:03.206300117-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.10","depends_on_id":"ArcataAI-0cn.2","type":"blocks","created_at":"2025-12-22T19:41:03.218550778-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.11","title":"Create IngestionProgress component with step indicators","description":"Create apps/hq/src/routes/jobs/IngestionProgress.tsx\n\nProps:\ninterface IngestionProgressProps {\n  status: 'processing' | 'success' | 'error';\n  currentStep: number;\n  totalSteps: number;  // Dynamic! 7 for new job, 3 for existing\n  stepName: string;\n  error?: string;\n}\n\nSteps for NEW job (totalSteps=7):\n1. Checking - Looking up job...\n2. Fetching - Getting job page... (HtmlFetcher)\n3. Parsing - Extracting job details... (JobParser)\n4. Resolving - Finding company... (CompanyResolver)\n5. Loading - Creating job record... (JobLoader)\n6. Streaming - Adding to your feed... (StreamLoader)\n7. Tracking - Creating application... (ApplicationLoader, if enabled)\n\nSteps for EXISTING job (totalSteps=3):\n1. Checking - Looking up job... (found!)\n2. Streaming - Adding to your feed...\n3. Tracking - Creating application...\n\nUI: Horizontal dots progress indicator\n- Shows step name with animated dots: 'Checking...' -\u003e 'Fetching...' etc\n- Complete steps: solid indigo dot\n- Current step: indigo dot with pulsing ring\n- Upcoming steps: gray dot\n- 'Step X of Y' label (Y is dynamic)\n\nOn error: Show which step failed with error message\nOn success: Show all dots complete briefly, then transition\n\nThis component replaces 'Add Job' button in HQ header while processing.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:40:50.747883196-05:00","updated_at":"2025-12-22T20:33:39.610542757-05:00","closed_at":"2025-12-22T20:33:39.610542757-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.11","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:40:50.748443117-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.12","title":"Hoist job ingestion state to HQ.tsx","description":"Move job ingestion state management to HQ.tsx\n\nState:\ninterface IngestionState {\n  status: 'idle' | 'processing' | 'success' | 'error';\n  currentStep: number;  // 0 when idle, 1-6 during processing\n  stepName: string;     // 'Fetching', 'Parsing', etc.\n  jobId?: number;\n  streamId?: number;\n  applicationId?: number;\n  error?: string;\n}\n\nStep name mapping:\n1: 'Fetching'\n2: 'Parsing'\n3: 'Resolving'\n4: 'Loading'\n5: 'Streaming'\n6: 'Tracking'\n\nFlow in HQ.tsx:\n1. handleSubmitJob(url) called from AddJobPopover\n2. Set status='processing', step=1\n3. Call ingestJobWithProgress() with onProgress callback\n4. onProgress updates currentStep and stepName as server emits\n5. On complete: set status='success', wait 1s, open JobDetailPanel, reset to idle\n6. On error: set status='error' with error message, require manual dismiss\n\nHeader rendering:\n- idle: show AddJobPopover\n- processing: show IngestionProgress with step/stepName\n- success: show IngestionProgress with all complete (brief)\n- error: show IngestionProgress with error + X dismiss button\n\nRevalidate data immediately on success.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:40:57.987426268-05:00","updated_at":"2025-12-22T21:58:02.211363611-05:00","closed_at":"2025-12-22T21:58:02.211363611-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.12","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:40:57.988193644-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.12","depends_on_id":"ArcataAI-0cn.10","type":"blocks","created_at":"2025-12-22T19:41:03.230136292-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.12","depends_on_id":"ArcataAI-0cn.11","type":"blocks","created_at":"2025-12-22T19:41:03.242665376-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.12","depends_on_id":"ArcataAI-0cn.4","type":"blocks","created_at":"2025-12-22T19:41:03.254602896-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.12","depends_on_id":"ArcataAI-0cn.13","type":"blocks","created_at":"2025-12-22T19:41:29.414259601-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.13","title":"Simplify AddJobPopover to just collect URL","description":"Simplify apps/hq/src/routes/jobs/AddJobByUrl.tsx\n\nRemove:\n- Route action (no longer needed)\n- useFetcher (parent handles submission)\n- Success/error handling in component\n\nAddJobPopover now just:\n- Renders popover with URL input\n- Validates URL with joi\n- Calls onSubmit(url) prop and closes popover\n- Parent (HQ.tsx) handles the rest\n\nProps:\ninterface AddJobPopoverProps {\n  actuator: ReactNode;\n  onSubmit: (url: string) =\u003e void;\n  disabled?: boolean;\n}","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:41:25.86427536-05:00","updated_at":"2025-12-22T20:36:42.996734738-05:00","closed_at":"2025-12-22T20:36:42.996734738-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.13","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:41:25.864908144-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.2","title":"Create API client for Scala backend","description":"Create apps/hq/src/lib/api.ts with typed API client. Based on OpenAPI spec:\n\nTypes:\n- IngestJobRequest: { url: string, source?: string, createApplication?: boolean, notes?: string }\n- IngestJobResponse: { success: boolean, jobId: number, streamId?: number, applicationId?: number, message: string }\n- JobErrorResponse: { success: boolean, error: string, details?: string }\n\nFunctions:\n- getApiUrl(): string - reads VITE_API_URL from env\n- ingestJob(request: IngestJobRequest, token: string): Promise\u003cIngestJobResponse\u003e\n  - POST to /api/v1/jobs/ingest\n  - Authorization: Bearer \u003ctoken\u003e\n  - Content-Type: application/json\n  - Handle errors, return typed response","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:01:05.255965613-05:00","updated_at":"2025-12-22T21:40:45.901879253-05:00","closed_at":"2025-12-22T21:40:45.901879253-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.2","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:05.257395033-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.2","depends_on_id":"ArcataAI-0cn.1","type":"blocks","created_at":"2025-12-22T19:02:05.869426963-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.3","title":"Create Notification component","description":"Create libs/components/src/lib/notifications/Notification.tsx\n\nFeatures:\n- Toast-style notification with Transition animation\n- States: loading (spinner), success (CheckCircleIcon), error (XCircleIcon)\n- Auto-dismiss after configurable timeout (default 5s for success)\n- Manual dismiss via X button\n- Props: { show, onClose, title, message, variant: 'loading' | 'success' | 'error' }\n\nAlso create NotificationProvider context for global notifications:\n- useNotification() hook returns { notify, dismiss }\n- Renders notification portal at document root\n\nExport from libs/components/src/index.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:01:14.422937459-05:00","updated_at":"2025-12-22T20:27:07.24628079-05:00","closed_at":"2025-12-22T20:27:07.24628079-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.3","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:14.42387003-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.4","title":"Create JobDetailPanel side panel component","description":"Create apps/hq/src/routes/jobs/JobDetailPanel.tsx\n\nStubbed side panel using HeadlessUI Dialog that slides in from right (max-w-2xl).\n\nProps:\n- isOpen: boolean\n- onClose: () =\u003e void  \n- jobId: number | null\n- jobData?: { title: string, company: string, url: string } (optional, for immediate display)\n\nContent (stubbed):\n- Header with job title and close button\n- Company name\n- Link to original job posting\n- Placeholder sections for: Job Description, Requirements, Match Score, Notes\n- Footer with action buttons (placeholder)\n\nThis is a stub - full implementation comes later.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:01:23.666755521-05:00","updated_at":"2025-12-22T20:30:50.982982806-05:00","closed_at":"2025-12-22T20:30:50.982982806-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.4","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:23.667547567-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.5","title":"Update AddJobByUrl action to call real API","description":"Update apps/hq/src/routes/jobs/AddJobByUrl.tsx action function:\n\n1. Get session token from Supabase auth (getSession from @arcata/db)\n2. Call ingestJob() from api.ts with URL and token\n3. Return response shape: { success, error, jobId, streamId, message }\n\nThe action now:\n- Validates URL with joi (existing)\n- Gets auth token\n- Calls Scala API\n- Returns structured response for UI to consume\n\nError handling:\n- No session -\u003e return { success: false, error: 'Not authenticated' }\n- API error -\u003e return { success: false, error: response.error, details: response.details }\n- Network error -\u003e return { success: false, error: 'Network error' }","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:01:32.942779508-05:00","updated_at":"2025-12-22T19:41:14.890832914-05:00","closed_at":"2025-12-22T19:41:14.890832914-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.5","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:32.943702419-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.5","depends_on_id":"ArcataAI-0cn.2","type":"blocks","created_at":"2025-12-22T19:02:05.888458325-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.6","title":"Update AddJobPopover UI for processing states","description":"Update apps/hq/src/routes/jobs/AddJobByUrl.tsx AddJobPopover component:\n\n1. Track submission state via fetcher.state ('idle', 'submitting', 'loading')\n2. Show notification on submit start (loading state)\n3. On success:\n   - Show success notification\n   - Close popover\n   - Trigger data revalidation (useRevalidator or navigate with replace)\n   - Open JobDetailPanel with returned jobId\n4. On error:\n   - Show error notification with message\n   - Keep popover open for retry\n\nState management:\n- Use useState for panel visibility: [panelJobId, setPanelJobId]\n- Use useEffect to react to fetcher.data changes\n\nButton states:\n- Disabled during submission\n- Shows spinner or 'Processing...' text","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:01:42.782527837-05:00","updated_at":"2025-12-22T19:41:19.147317085-05:00","closed_at":"2025-12-22T19:41:19.147317085-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.6","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:42.783256921-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.6","depends_on_id":"ArcataAI-0cn.3","type":"blocks","created_at":"2025-12-22T19:02:05.906980281-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.6","depends_on_id":"ArcataAI-0cn.4","type":"blocks","created_at":"2025-12-22T19:02:05.924932055-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.6","depends_on_id":"ArcataAI-0cn.5","type":"blocks","created_at":"2025-12-22T19:02:05.942032206-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.7","title":"Integrate NotificationProvider into HQ app","description":"Wrap HQ app with NotificationProvider:\n\n1. Update apps/hq/src/main.tsx or App.tsx to include NotificationProvider\n2. Ensure notification portal renders at document root level\n3. Test that useNotification() hook works from AddJobByUrl component\n\nThis enables global toast notifications across the HQ app.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T19:01:50.169569164-05:00","updated_at":"2025-12-22T21:40:45.920010516-05:00","closed_at":"2025-12-22T21:40:45.920010516-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.7","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:50.17029457-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.7","depends_on_id":"ArcataAI-0cn.3","type":"blocks","created_at":"2025-12-22T19:02:05.960462454-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.8","title":"Add translations for job submission flow","description":"Add translation keys to apps/hq/public/locales/en.json\n\npages.hq.notifications:\n  processing: 'Processing job URL...'\n  success: 'Job added successfully'\n  error: 'Failed to add job'\n\npages.hq.ingestion:\n  stepOf: 'Step {{current}} of {{total}}'\n  steps:\n    fetching: 'Fetching'\n    parsing: 'Parsing'\n    resolving: 'Resolving'\n    loading: 'Loading'\n    streaming: 'Streaming'\n    tracking: 'Tracking'\n  errorAt: 'Failed at {{step}}'\n  errorRetry: 'Something went wrong. Try adding the job again.'\n\npages.hq.jobDetail:\n  title: 'Job Details'\n  apply: 'Apply'\n  department: 'Department'\n  location: 'Location'\n  jobUrl: 'Job URL'\n  description: 'Description'\n  qualifications: 'Qualifications'\n  responsibilities: 'Responsibilities'\n  loading: 'Loading job details...'","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T19:01:58.396826488-05:00","updated_at":"2025-12-22T21:40:45.938090919-05:00","closed_at":"2025-12-22T21:40:45.938090919-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.8","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:01:58.397677379-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0cn.9","title":"Add WebSocket endpoint for job ingestion progress","description":"Add WebSocket endpoint and ProgressEmitter to ETL framework.\n\nPart 1: Create ProgressEmitter trait in framework\n- File: apps/api/src/main/scala/arcata/api/etl/framework/ProgressEmitter.scala\n\ntrait ProgressEmitter:\n  def emit(step: Int, totalSteps: Int, status: String, message: String): Unit\n\nobject ProgressEmitter:\n  val noop: ProgressEmitter = (_, _, _, _) =\u003e ()\n\nPart 2: Update JobIngestionPipeline to accept ProgressEmitter\n- Add optional progressEmitter parameter\n- Emit progress before each step\n- totalSteps is dynamic: 7 for new job, 3 for existing job\n\nNew job flow:\n1. 'checking' - 'Looking up job...'\n2. 'fetching' - 'Getting job page...'\n3. 'parsing' - 'Extracting job details...'\n4. 'resolving' - 'Finding company...'\n5. 'loading' - 'Creating job record...'\n6. 'streaming' - 'Adding to your feed...'\n7. 'tracking' - 'Creating application...' (if enabled)\n\nExisting job flow:\n1. 'checking' - 'Looking up job...' (found!)\n2. 'streaming' - 'Adding to your feed...'\n3. 'tracking' - 'Creating application...' (if enabled)\n\n- Emit 'complete' or 'error' at end\n\nPart 3: Create WebSocket endpoint\n- File: apps/api/src/main/scala/arcata/api/http/routes/JobRoutes.scala\n- Endpoint: /api/v1/jobs/ingest/ws?token=xxx\n\nProgress message format:\n{ \"step\": 1, \"totalSteps\": 7, \"status\": \"checking\", \"message\": \"Looking up job...\" }\n{ \"step\": 7, \"totalSteps\": 7, \"status\": \"complete\", \"jobId\": 123, \"streamId\": 456, \"applicationId\": 789 }\n{ \"step\": 2, \"totalSteps\": 7, \"status\": \"error\", \"error\": \"Failed to fetch page\" }\n\nServer closes connection after complete/error.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:40:36.577884921-05:00","updated_at":"2025-12-22T21:53:27.180949854-05:00","closed_at":"2025-12-22T21:53:27.180949854-05:00","dependencies":[{"issue_id":"ArcataAI-0cn.9","depends_on_id":"ArcataAI-0cn","type":"parent-child","created_at":"2025-12-22T19:40:36.57867964-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-0cn.9","depends_on_id":"ArcataAI-732.8","type":"blocks","created_at":"2025-12-22T20:08:35.649687826-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-0y4","title":"Create docs/architecture.md","description":"Create high-level architecture documentation with ASCII system diagram showing: Auth (:4200), HQ (:4201), API (:4203), Supabase, ObjectStorage, BoogieLoops. Include component descriptions, shared libraries table, and external services table with links to ObjectStorage and BoogieLoops repos.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-22T18:40:06.211440628-05:00","updated_at":"2025-12-22T18:41:42.569010098-05:00","closed_at":"2025-12-22T18:41:42.569010098-05:00"}
{"id":"ArcataAI-330","title":"Refactor auth module to be self-contained","description":"Extract auth decorator from JobRoutes into a self-contained auth module that owns its own config. Support multiple auth types (JWT, API keys) with clean decorator API: @authenticated(Vector(AuthType.JWT, AuthType.ApiKey))","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T10:59:46.437279259-05:00","updated_at":"2025-12-23T11:09:01.270517247-05:00","closed_at":"2025-12-23T11:09:01.270517247-05:00"}
{"id":"ArcataAI-330.1","title":"Create AuthConfig.scala - self-contained config singleton","description":"Create auth/AuthConfig.scala that lazy-loads auth config from environment variables (SUPABASE_JWT_SECRET, API_KEYS). The auth module should own its configuration, not receive it from ApiApp.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:59:50.844131691-05:00","updated_at":"2025-12-23T11:01:19.94994637-05:00","closed_at":"2025-12-23T11:01:19.94994637-05:00","dependencies":[{"issue_id":"ArcataAI-330.1","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T10:59:50.844772592-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.2","title":"Create AuthTypes.scala - enums and result types","description":"Create auth/AuthTypes.scala with: AuthType enum (JWT, ApiKey), AuthResult sealed trait (Success, Failure), updated AuthenticatedRequest case class with authType field.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:59:55.219307288-05:00","updated_at":"2025-12-23T11:01:36.690575251-05:00","closed_at":"2025-12-23T11:01:36.690575251-05:00","dependencies":[{"issue_id":"ArcataAI-330.2","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T10:59:55.219893974-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.3","title":"Create ApiKeyValidator.scala","description":"Create auth/ApiKeyValidator.scala that validates X-API-Key header against configured API keys from AuthConfig.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:59:59.163152032-05:00","updated_at":"2025-12-23T11:01:52.41879436-05:00","closed_at":"2025-12-23T11:01:52.41879436-05:00","dependencies":[{"issue_id":"ArcataAI-330.3","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T10:59:59.163783465-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.4","title":"Rewrite AuthDecorators.scala with authenticated decorator","description":"Rewrite auth/AuthDecorators.scala with the 'authenticated' RawDecorator class. Should accept allowedTypes: Vector[AuthType] param (default JWT only). Try each auth type until success. Pass authReq to handler.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:00:04.258061154-05:00","updated_at":"2025-12-23T11:02:20.445760592-05:00","closed_at":"2025-12-23T11:02:20.445760592-05:00","dependencies":[{"issue_id":"ArcataAI-330.4","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T11:00:04.258630726-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.4","depends_on_id":"ArcataAI-330.1","type":"blocks","created_at":"2025-12-23T11:00:24.51928749-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.4","depends_on_id":"ArcataAI-330.2","type":"blocks","created_at":"2025-12-23T11:00:24.532914977-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.4","depends_on_id":"ArcataAI-330.3","type":"blocks","created_at":"2025-12-23T11:00:24.544900217-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.5","title":"Update JobRoutes.scala to use new auth decorator","description":"Remove jwtValidator param from JobRoutes constructor. Remove inner 'authenticated' class. Import and use @authenticated() decorator from auth package. Update handler param name to authReq.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:00:08.282910336-05:00","updated_at":"2025-12-23T11:03:49.201528131-05:00","closed_at":"2025-12-23T11:03:49.201528131-05:00","dependencies":[{"issue_id":"ArcataAI-330.5","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T11:00:08.283703354-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.5","depends_on_id":"ArcataAI-330.4","type":"blocks","created_at":"2025-12-23T11:00:28.206587545-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.6","title":"Update ApiApp.scala - remove jwtValidator wiring","description":"Remove 'lazy val jwtValidator' from ApiApp. Remove jwtValidator param from JobRoutes instantiation. Auth module now owns its config.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:00:11.734822637-05:00","updated_at":"2025-12-23T11:04:28.21419692-05:00","closed_at":"2025-12-23T11:04:28.21419692-05:00","dependencies":[{"issue_id":"ArcataAI-330.6","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T11:00:11.736265735-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.6","depends_on_id":"ArcataAI-330.5","type":"blocks","created_at":"2025-12-23T11:00:28.217909921-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.7","title":"Update .env.example with API_KEYS variable","description":"Add API_KEYS environment variable to apps/api/.env.example with documentation comment explaining format (comma-separated).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:00:15.657001424-05:00","updated_at":"2025-12-23T11:04:47.758058539-05:00","closed_at":"2025-12-23T11:04:47.758058539-05:00","dependencies":[{"issue_id":"ArcataAI-330.7","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T11:00:15.65758343-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-330.8","title":"Write tests for auth module using utest","description":"Write comprehensive tests for: AuthConfig loading, ApiKeyValidator, authenticated decorator (JWT auth, API key auth, combined auth, failure cases). Use utest library.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T11:00:19.788935565-05:00","updated_at":"2025-12-23T11:09:01.258912285-05:00","closed_at":"2025-12-23T11:09:01.258912285-05:00","dependencies":[{"issue_id":"ArcataAI-330.8","depends_on_id":"ArcataAI-330","type":"parent-child","created_at":"2025-12-23T11:00:19.790250412-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-330.8","depends_on_id":"ArcataAI-330.4","type":"blocks","created_at":"2025-12-23T11:00:31.743922193-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-43a","title":"Remove unused @arcata/envs library","description":"The libs/envs package is declared as a dependency in multiple package.json files but never actually imported in any TypeScript code. Remove the library and all references to it.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-22T19:06:20.886846884-05:00","updated_at":"2025-12-23T08:28:13.974862584-05:00","closed_at":"2025-12-23T08:28:13.974862584-05:00"}
{"id":"ArcataAI-4bh","title":"Wire up JobDetailPanel to fetch and display actual job data after ingestion","description":"After successful job ingestion, the side panel opens but shows placeholder text instead of real job data.\n\n**Current behavior (HQ.tsx:100-108):**\n- Sets hardcoded: `{ title: 'New Job', company: '', url: '' }`\n- Panel shows 'Job description will appear here', etc.\n\n**Expected:**\n- Fetch job details from API using the jobId\n- Display actual title, description, requirements, company name\n- Show the extracted data from the ingestion pipeline\n\n**Files:**\n- apps/hq/src/routes/hq/HQ.tsx (line 104)\n- apps/hq/src/routes/jobs/JobDetailPanel.tsx","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-23T15:17:41.867715263-05:00","updated_at":"2025-12-23T15:17:41.867715263-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-4bh","depends_on_id":"ArcataAI-eh7","type":"related","created_at":"2025-12-23T15:59:34.849726223-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j","title":"Rewrite API tests from munit to utest framework","description":"The API tests are written using munit but build.sc is configured for utest. Need to remove all munit tests and rewrite using proper utest patterns.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:33:41.512606674-05:00","updated_at":"2025-12-23T10:43:08.940859916-05:00","closed_at":"2025-12-23T10:43:08.940859916-05:00"}
{"id":"ArcataAI-59j.1","title":"Remove old munit test files","description":"Delete all 10 existing test files that use munit framework","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:33:47.537565792-05:00","updated_at":"2025-12-23T10:35:02.384038281-05:00","closed_at":"2025-12-23T10:35:02.384038281-05:00","dependencies":[{"issue_id":"ArcataAI-59j.1","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:33:47.538145183-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j.2","title":"Write DomainModelsSuite using utest","description":"Test domain models (Company, Job, ExtractedJobData, JobStreamEntry, JobApplication) JSON serialization with upickle","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:33:53.443430493-05:00","updated_at":"2025-12-23T10:35:49.885022783-05:00","closed_at":"2025-12-23T10:35:49.885022783-05:00","dependencies":[{"issue_id":"ArcataAI-59j.2","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:33:53.444255192-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j.3","title":"Write ETL framework tests using utest","description":"Test BaseStep, BasePipeline, PipelineContext, StepError - covers step composition, error handling, context creation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:33:59.357963835-05:00","updated_at":"2025-12-23T10:36:56.781536674-05:00","closed_at":"2025-12-23T10:36:56.781536674-05:00","dependencies":[{"issue_id":"ArcataAI-59j.3","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:33:59.358558396-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j.4","title":"Write ETL step tests using utest","description":"Test JobLoader, StreamLoader, ApplicationLoader, CompanyResolver steps with mock SupabaseClient","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:34:05.262610265-05:00","updated_at":"2025-12-23T10:38:14.206352422-05:00","closed_at":"2025-12-23T10:38:14.206352422-05:00","dependencies":[{"issue_id":"ArcataAI-59j.4","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:34:05.263504009-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j.5","title":"Write ObjectStorageClient tests using utest","description":"Test ObjectStorageClient URL building and API interactions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:34:12.013904889-05:00","updated_at":"2025-12-23T10:38:59.381500889-05:00","closed_at":"2025-12-23T10:38:59.381500889-05:00","dependencies":[{"issue_id":"ArcataAI-59j.5","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:34:12.014645464-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-59j.6","title":"Verify all tests pass with utest runner","description":"Run ./mill api.test and ensure all new utest tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:34:18.534503016-05:00","updated_at":"2025-12-23T10:43:07.717550576-05:00","closed_at":"2025-12-23T10:43:07.717550576-05:00","dependencies":[{"issue_id":"ArcataAI-59j.6","depends_on_id":"ArcataAI-59j","type":"parent-child","created_at":"2025-12-23T10:34:18.535205888-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-5nt","title":"Rewrite root README.md","description":"Replace the outdated README with a new developer-focused quick start guide. Must include: mission statement (candidate-first, O'Saasy promise), prerequisites (Bun, Supabase CLI, Mill), setup instructions, local Supabase guidance with link to CLI docs, dev server commands, project structure overview, links to docs/architecture.md and apps/api/README.md, license section.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-22T18:40:03.568237117-05:00","updated_at":"2025-12-22T18:41:09.678503543-05:00","closed_at":"2025-12-22T18:41:09.678503543-05:00"}
{"id":"ArcataAI-732","title":"Rework ETL to use BoogieLoops AI directly","description":"Replace external BoogieLoops API calls with direct BoogieLoops AI Agent usage via Vercel AI Gateway. Includes: AI config, JobExtractionAgent, CompanyEnrichmentAgent, updated JobParser step, updated CompanyResolver step.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-22T20:07:19.021507555-05:00","updated_at":"2025-12-22T21:49:00.042958129-05:00","closed_at":"2025-12-22T21:49:00.042958129-05:00"}
{"id":"ArcataAI-732.1","title":"Update Config with AI provider settings","description":"Update apps/api/src/main/scala/arcata/api/config/Config.scala\n\nReplace BoogieLoopsConfig with AIConfig:\n\nfinal case class AIConfig(\n    baseUrl: String,      // Vercel AI Gateway: https://api.vercel.ai/v1\n    apiKey: String,       // VERCEL_AI_GATEWAY_API_KEY\n    model: String         // anthropic/claude-sonnet-4-20250514\n)\n\nUpdate environment variable loading:\n- VERCEL_AI_GATEWAY_URL (default: https://api.vercel.ai/v1)\n- VERCEL_AI_GATEWAY_API_KEY (required)\n- AI_MODEL (default: anthropic/claude-sonnet-4-20250514)\n\nUpdate .env.example with new variables.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:07:25.968580865-05:00","updated_at":"2025-12-22T20:50:51.275402876-05:00","closed_at":"2025-12-22T20:50:51.275402876-05:00","dependencies":[{"issue_id":"ArcataAI-732.1","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:07:25.969186437-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.10","title":"Add early exit check for existing jobs in pipeline","description":"Address TODO on line 52 of JobIngestionPipeline.scala: 'look up existing job first! so we can exit early'\n\nAdd a new step at the beginning of the pipeline:\n\nStep 0: Check if job already exists by source URL\n- Call supabaseClient.findJobBySourceUrl(input.url)\n- If job exists:\n  - Skip HTML fetch, parsing, company resolution, job loading\n  - Go directly to StreamLoader (add to user's stream if not already there)\n  - Then ApplicationLoader if createApplication=true\n- If job doesn't exist:\n  - Continue with full pipeline\n\nThis optimization:\n1. Saves AI/API costs (no parsing needed)\n2. Faster response for duplicate URLs\n3. Still adds job to user's stream/applications\n\nImplementation approach:\n- Create new step: JobLookup (or inline check in execute())\n- Returns Either[StepError, Option[Job]]\n- If Some(job), short-circuit to step 5\n- If None, continue full pipeline\n\nAlso relates to company enrichment - only enrich NEW companies (option b from discussion).","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:11:25.649060085-05:00","updated_at":"2025-12-22T21:45:18.073418892-05:00","closed_at":"2025-12-22T21:45:18.073418892-05:00","dependencies":[{"issue_id":"ArcataAI-732.10","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:11:25.649643073-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.2","title":"Add Schematic derivation to domain models","description":"Update domain models to derive Schematic for BoogieLoops AI structured output.\n\nFile: apps/api/src/main/scala/arcata/api/domain/ExtractedJobData.scala\n- Add: derives ReadWriter, Schematic\n- Remove: rawText field (not needed, HTML stored in object storage)\n- Import: boogieloops.schema.derivation.Schematic\n\nCreate new model for company extraction:\nFile: apps/api/src/main/scala/arcata/api/domain/ExtractedCompanyData.scala\n\nfinal case class ExtractedCompanyData(\n    name: String,\n    domain: Option[String] = None,\n    industry: Option[String] = None,\n    size: Option[String] = None,        // startup, small, medium, large, enterprise\n    description: Option[String] = None,\n    headquarters: Option[String] = None,\n    websiteUrl: Option[String] = None\n) derives ReadWriter, Schematic","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:07:32.960257672-05:00","updated_at":"2025-12-22T20:53:21.10622406-05:00","closed_at":"2025-12-22T20:53:21.10622406-05:00","dependencies":[{"issue_id":"ArcataAI-732.2","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:07:32.960809058-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.3","title":"Create JobExtractionAgent","description":"Create apps/api/src/main/scala/arcata/api/ai/JobExtractionAgent.scala\n\nUses BoogieLoops AI Agent with OpenAICompatibleProvider via Vercel AI Gateway.\n\nclass JobExtractionAgent(config: AIConfig):\n  private val provider = OpenAICompatibleProvider(\n    baseUrl = config.baseUrl,\n    apiKey = config.apiKey,\n    modelId = config.model,\n    strictModelValidation = false\n  )\n  \n  private val agent = Agent(\n    name = \"JobExtractor\",\n    instructions = \"\"\"You are a job posting parser. Given HTML content from a job posting page,\nextract structured job information. Be thorough but concise. If information is not present,\nleave the field empty rather than guessing.\"\"\",\n    provider = provider,\n    model = config.model,\n    temperature = Some(0.1)  // Low temp for consistent extraction\n  )\n  \n  def extract(html: String, url: String): Either[SchemaError, ExtractedJobData] =\n    agent.generateObjectWithoutHistory[ExtractedJobData](\n      s\"\"\"Extract job details from this HTML. Source URL: $url\n      \nHTML Content:\n$html\"\"\",\n      RequestMetadata()\n    ).map(_.data)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:07:41.368941884-05:00","updated_at":"2025-12-22T21:40:45.955947695-05:00","closed_at":"2025-12-22T21:40:45.955947695-05:00","dependencies":[{"issue_id":"ArcataAI-732.3","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:07:41.369535442-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.3","depends_on_id":"ArcataAI-732.1","type":"blocks","created_at":"2025-12-22T20:08:30.339437238-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.3","depends_on_id":"ArcataAI-732.2","type":"blocks","created_at":"2025-12-22T20:08:30.351560756-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.4","title":"Create CompanyEnrichmentAgent","description":"Create apps/api/src/main/scala/arcata/api/ai/CompanyEnrichmentAgent.scala\n\nUses BoogieLoops AI Agent to enrich company data from job posting context.\n\nclass CompanyEnrichmentAgent(config: AIConfig):\n  private val provider = OpenAICompatibleProvider(...)\n  \n  private val agent = Agent(\n    name = \"CompanyEnricher\",\n    instructions = \"\"\"You extract and enrich company information from job posting context.\nGiven the company name, job posting HTML, and URL, extract additional company details\nthat can be inferred from the content.\"\"\",\n    provider = provider,\n    model = config.model,\n    temperature = Some(0.1)\n  )\n  \n  def enrich(\n    companyName: String,\n    html: String,\n    url: String\n  ): Either[SchemaError, ExtractedCompanyData] =\n    agent.generateObjectWithoutHistory[ExtractedCompanyData](\n      s\"\"\"Extract company information for '$companyName' from this job posting.\nURL: $url\n\nHTML Content:\n$html\"\"\",\n      RequestMetadata()\n    ).map(_.data)\n\nThis enriches company records with industry, size, description, etc.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:07:49.132609219-05:00","updated_at":"2025-12-22T21:40:45.973857976-05:00","closed_at":"2025-12-22T21:40:45.973857976-05:00","dependencies":[{"issue_id":"ArcataAI-732.4","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:07:49.133153582-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.4","depends_on_id":"ArcataAI-732.1","type":"blocks","created_at":"2025-12-22T20:08:30.363606251-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.4","depends_on_id":"ArcataAI-732.2","type":"blocks","created_at":"2025-12-22T20:08:30.375122774-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.5","title":"Rework JobParser step to use JobExtractionAgent","description":"Update apps/api/src/main/scala/arcata/api/etl/steps/JobParser.scala\n\nRemove:\n- HTTP calls to external BoogieLoops API\n- BoogieLoopsConfig dependency\n- BoogieLoopsResponse case class\n\nAdd:\n- JobExtractionAgent dependency\n- AIConfig dependency\n\nUpdated execute():\n1. Call jobExtractionAgent.extract(input.html, input.url)\n2. Map SchemaError to StepError.TransformationError\n3. Return JobParserOutput with extracted data\n\nConstructor change:\n- Old: JobParser(config: BoogieLoopsConfig)\n- New: JobParser(aiConfig: AIConfig)\n\nInternal: Creates JobExtractionAgent instance","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:07:55.786194568-05:00","updated_at":"2025-12-22T21:45:18.036634777-05:00","closed_at":"2025-12-22T21:45:18.036634777-05:00","dependencies":[{"issue_id":"ArcataAI-732.5","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:07:55.786871961-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.5","depends_on_id":"ArcataAI-732.3","type":"blocks","created_at":"2025-12-22T20:08:30.387385413-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.6","title":"Rework CompanyResolver step to use CompanyEnrichmentAgent","description":"Update apps/api/src/main/scala/arcata/api/etl/steps/CompanyResolver.scala\n\nAdd:\n- CompanyEnrichmentAgent dependency\n- AIConfig dependency\n- HTML passed through from previous step (update input/output types)\n\nUpdated flow:\n1. Extract domain from URL (existing logic)\n2. Look up company by domain in DB\n3. If found:\n   - Check if company needs enrichment (missing industry, size, etc.)\n   - If needs enrichment, call companyEnrichmentAgent.enrich()\n   - Update company record with enriched data\n4. If not found:\n   - Call companyEnrichmentAgent.enrich() to get full company data\n   - Create new company with enriched data\n\nUpdate CompanyResolverInput to include html field.\nUpdate Company domain model if needed for new fields (industry, size, etc.)\n\nConstructor change:\n- Old: CompanyResolver(supabaseClient: SupabaseClient)\n- New: CompanyResolver(supabaseClient: SupabaseClient, aiConfig: AIConfig)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:08:03.621993476-05:00","updated_at":"2025-12-22T21:47:47.550553854-05:00","closed_at":"2025-12-22T21:47:47.550553854-05:00","dependencies":[{"issue_id":"ArcataAI-732.6","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:08:03.622736427-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.6","depends_on_id":"ArcataAI-732.4","type":"blocks","created_at":"2025-12-22T20:08:30.39957561-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.6","depends_on_id":"ArcataAI-732.7","type":"blocks","created_at":"2025-12-22T20:08:30.411463839-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.7","title":"Update Company domain model with enrichment fields","description":"Update apps/api/src/main/scala/arcata/api/domain/Company.scala\n\nAdd fields to match ExtractedCompanyData:\n- industry: Option[String] = None\n- companySize: Option[String] = None  // startup, small, medium, large, enterprise\n- description: Option[String] = None\n- headquarters: Option[String] = None\n\nUpdate SupabaseClient company methods to handle new fields.\n\nMay need Supabase migration to add columns to companies table:\n- industry VARCHAR\n- company_size VARCHAR\n- description TEXT\n- headquarters VARCHAR","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:08:09.511404162-05:00","updated_at":"2025-12-22T21:45:18.05299956-05:00","closed_at":"2025-12-22T21:45:18.05299956-05:00","dependencies":[{"issue_id":"ArcataAI-732.7","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:08:09.512117114-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.7","depends_on_id":"ArcataAI-732.9","type":"blocks","created_at":"2025-12-22T20:08:30.424381927-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.8","title":"Update JobIngestionPipeline for new AI config","description":"Update apps/api/src/main/scala/arcata/api/etl/JobIngestionPipeline.scala\n\nConstructor change:\n- Old: JobIngestionPipeline(supabaseClient, boogieLoopsConfig, storageClient)\n- New: JobIngestionPipeline(supabaseClient, aiConfig, storageClient)\n\nUpdate step initialization:\n- jobParser = JobParser(aiConfig)\n- companyResolver = CompanyResolver(supabaseClient, aiConfig)\n\nUpdate execute() to pass HTML through to CompanyResolver:\n- CompanyResolverInput now needs html field\n- Pass fetcherOutput.html to companyResolver step\n\nUpdate ApiApp.scala to use new AIConfig instead of BoogieLoopsConfig.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:08:16.556802139-05:00","updated_at":"2025-12-22T21:48:50.468857469-05:00","closed_at":"2025-12-22T21:48:50.468857469-05:00","dependencies":[{"issue_id":"ArcataAI-732.8","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:08:16.557377392-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.8","depends_on_id":"ArcataAI-732.5","type":"blocks","created_at":"2025-12-22T20:08:30.436829327-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.8","depends_on_id":"ArcataAI-732.6","type":"blocks","created_at":"2025-12-22T20:08:30.448042718-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-732.8","depends_on_id":"ArcataAI-732.10","type":"blocks","created_at":"2025-12-22T20:11:30.880713213-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-732.9","title":"Add Supabase migration for company enrichment fields","description":"Create supabase/migrations/20241222000010_add_company_enrichment_fields.sql\n\nALTER TABLE companies ADD COLUMN IF NOT EXISTS industry VARCHAR;\nALTER TABLE companies ADD COLUMN IF NOT EXISTS company_size VARCHAR;\nALTER TABLE companies ADD COLUMN IF NOT EXISTS description TEXT;\nALTER TABLE companies ADD COLUMN IF NOT EXISTS headquarters VARCHAR;\n\n-- Add index for industry filtering\nCREATE INDEX IF NOT EXISTS idx_companies_industry ON companies(industry);\n\nRun: supabase db push to apply migration","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T20:08:22.363455525-05:00","updated_at":"2025-12-22T20:51:37.035764371-05:00","closed_at":"2025-12-22T20:51:37.035764371-05:00","dependencies":[{"issue_id":"ArcataAI-732.9","depends_on_id":"ArcataAI-732","type":"parent-child","created_at":"2025-12-22T20:08:22.364046279-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-733","title":"Create apps/api/README.md with ETL diagram","description":"Create API service documentation with: prerequisites (Java 11+, Mill), setup instructions, make commands, ETL pipeline ASCII diagram showing HtmlFetcher -\u003e JobParser -\u003e CompanyResolver -\u003e JobLoader/StreamLoader/ApplicationLoader flow. Include pipeline steps table and links to ObjectStorage, BoogieLoops, Mill docs, Cask docs, and back to system architecture.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-22T18:40:09.110647261-05:00","updated_at":"2025-12-22T18:42:14.980871458-05:00","closed_at":"2025-12-22T18:42:14.980871458-05:00"}
{"id":"ArcataAI-7ne","title":"Implement Track Job button functionality","description":"The 'Track Job' button in JobDetailPanel is currently disabled and does nothing.\n\n**Current state:**\n- Button is `disabled` in JobDetailPanel.tsx (line 159-165)\n- JobStreamPage has a TODO placeholder: `handleTrack` does nothing (line 242-244)\n\n**Expected:**\n- Clicking Track Job should create a job_application record\n- Move the job from the stream to the user's tracking board\n- Update UI to reflect the tracked state\n\n**Files:**\n- apps/hq/src/routes/jobs/JobDetailPanel.tsx (lines 159-165)\n- apps/hq/src/routes/job-stream/JobStreamPage.tsx (lines 242-244)\n\n**API needed:**\n- POST /api/v1/applications or similar to create tracking entry","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-23T15:17:49.452145052-05:00","updated_at":"2025-12-23T15:17:49.452145052-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-7ne","depends_on_id":"ArcataAI-eh7","type":"related","created_at":"2025-12-23T15:59:34.86387716-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-8h8","title":"Fix CORS issue in Scala API for UI requests","description":"The HQ frontend is hitting CORS errors when calling the Scala API. Need to add CORS headers to allow cross-origin requests from the UI.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T10:25:38.341818084-05:00","updated_at":"2025-12-23T10:28:35.034770756-05:00","closed_at":"2025-12-23T10:28:35.034770756-05:00"}
{"id":"ArcataAI-adp","title":"Update package.json license field","description":"Change license field from 'MIT' to 'SEE LICENSE.md' to reflect the O'Saasy license.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-22T18:40:10.632742613-05:00","updated_at":"2025-12-22T18:42:32.352676129-05:00","closed_at":"2025-12-22T18:42:32.352676129-05:00"}
{"id":"ArcataAI-d10","title":"Refactor data sanitization out of SupabaseClient into ETL layer","description":"Currently filtering empty timestamp strings in writeJobForInsert(), but the client should be 'dumb' - all data normalization/sanitization should happen in ETL steps before reaching the client.\n\nLocation: apps/api/src/main/scala/arcata/api/clients/SupabaseClient.scala:164-165\n\nThe fix added .filter(_.nonEmpty) for postedDate/closingDate, but this logic belongs in the ETL layer (e.g., JobLoader or a dedicated sanitization step).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T15:07:55.022343021-05:00","updated_at":"2025-12-23T15:07:55.022343021-05:00","labels":["architecture","refactor"]}
{"id":"ArcataAI-dnp","title":"Fix Scalafix working directory in build.sc","description":"The `fixCheck` and `fix` tasks in build.sc are running in the wrong directory.\n\n**Error:**\n```\nCannot run program \"cs\" (in directory \"/home/matsilva/code/silvabyte/ArcataAI/apps/api/api\"): error=2, No such file or directory\n```\n\n**Problem:**\nThe `cwd` is set to `millSourcePath` which resolves to `apps/api/api` instead of `apps/api`.\n\n**File:** apps/api/build.sc\n\n**Fix:**\nChange `cwd = millSourcePath` to `cwd = millSourcePath / os.up` in the fix/fixCheck tasks (around lines 71 and 92).","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-23T09:31:59.394314855-05:00","updated_at":"2025-12-23T09:31:59.394314855-05:00"}
{"id":"ArcataAI-eh7","title":"Job Detail Panel \u0026 Track Job Feature","description":"Epic for implementing the full job detail panel UI and track job functionality.\n\nGoals:\n- Display full job details in side panel after ingestion\n- Allow users to track jobs (add to kanban board)\n- Shared components: Toast notifications, Spinner, Skeleton UI\n\nRelated Issues:\n- ArcataAI-4bh: Wire up JobDetailPanel to fetch and display actual job data\n- ArcataAI-7ne: Implement Track Job button functionality","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T15:57:50.66214012-05:00","updated_at":"2025-12-23T16:19:35.310702399-05:00","closed_at":"2025-12-23T16:19:35.310706658-05:00","labels":["feature","frontend"]}
{"id":"ArcataAI-eh7.1","title":"Create Toast notification system","description":"Create a reusable toast notification system in the shared components library.\n\nLocation: libs/components/src/lib/toast/\n\nComponents needed:\n- ToastProvider.tsx - Context provider with state management for showing/hiding toasts\n- Toast.tsx - Individual toast component using Headless UI Transition\n- useToast.ts - Hook for triggering toasts from anywhere in the app\n- index.ts - Exports\n\nFeatures:\n- Support types: success, error, warning, info\n- Auto-dismiss after configurable timeout (default 5s)\n- Position: top-right on all screen sizes\n- Dark mode support\n- Close button\n\nTemplate provided by user uses @headlessui/react Transition component.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:57:58.195509842-05:00","updated_at":"2025-12-23T16:07:51.801156852-05:00","closed_at":"2025-12-23T16:07:51.801165589-05:00","labels":["component","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.1","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:57:58.196187148-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.10","title":"Wire up Track button in Job Stream cards","description":"Connect the Track button in Job Stream cards to useTrackJob hook.\n\nFiles:\n- apps/hq/src/routes/job-stream/JobCard/JobCardActions.tsx\n- apps/hq/src/routes/job-stream/JobStreamPage.tsx\n\nChanges to JobStreamPage.tsx:\n- Update query to include application_id from job_stream\n- Pass application_id to JobCard components\n- Implement handleTrack using useTrackJob\n\nChanges to JobCardActions.tsx:\n- Accept isTracked and isTracking props\n- Show 'Tracked' (disabled) when isTracked is true\n- Show Spinner when isTracking is true\n\nBehavior:\n- Same as JobDetailPanel Track button\n- On success: show toast, update card state\n- On error: show error toast","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:59:05.299544294-05:00","updated_at":"2025-12-23T16:18:35.113437033-05:00","closed_at":"2025-12-23T16:18:35.113446882-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.10","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:59:05.300615821-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.10","depends_on_id":"ArcataAI-eh7.8","type":"blocks","created_at":"2025-12-23T15:59:29.586599932-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.10","depends_on_id":"ArcataAI-eh7.2","type":"blocks","created_at":"2025-12-23T15:59:29.598316967-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.10","depends_on_id":"ArcataAI-eh7.1","type":"blocks","created_at":"2025-12-23T15:59:29.610904865-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.11","title":"Update exports in libs/components","description":"Update the main index.ts in libs/components to export new components.\n\nFile: libs/components/src/lib/index.ts\n\nAdd exports for:\n- Toast components (ToastProvider, Toast, useToast)\n- Spinner component\n- Skeleton component\n\nEnsure all new components are properly exported from the library.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:59:10.370342694-05:00","updated_at":"2025-12-23T16:18:35.127651094-05:00","closed_at":"2025-12-23T16:18:35.127655783-05:00","labels":["chore","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.11","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:59:10.371596678-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.11","depends_on_id":"ArcataAI-eh7.1","type":"blocks","created_at":"2025-12-23T15:59:29.624480656-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.11","depends_on_id":"ArcataAI-eh7.2","type":"blocks","created_at":"2025-12-23T15:59:29.637498696-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.11","depends_on_id":"ArcataAI-eh7.3","type":"blocks","created_at":"2025-12-23T15:59:29.650953721-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.2","title":"Create Spinner/Loader component","description":"Create a reusable spinner component for loading states.\n\nLocation: libs/components/src/lib/spinner/\n\nComponents needed:\n- Spinner.tsx - Spinning circle SVG component\n- index.ts - Exports\n\nProps:\n- size: 'sm' | 'md' | 'lg' or number\n- className: for custom styling/colors\n\nUsage: Inline in buttons during async operations, standalone loading indicators.\n\nUses animate-spin Tailwind class.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:04.373221075-05:00","updated_at":"2025-12-23T16:07:51.815785971-05:00","closed_at":"2025-12-23T16:07:51.815792724-05:00","labels":["component","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.2","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:04.37387763-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.3","title":"Create Skeleton UI components","description":"Create reusable skeleton components for loading states.\n\nLocation: libs/components/src/lib/skeleton/\n\nComponents needed:\n- Skeleton.tsx - Base skeleton component with animate-pulse\n- index.ts - Exports\n\nProps:\n- variant: 'text' | 'circular' | 'rectangular'\n- width: string | number\n- height: string | number\n- className: for custom styling\n\nUses animate-pulse Tailwind class and bg-gray-200 for the shimmer effect.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:11.723802984-05:00","updated_at":"2025-12-23T16:07:51.831004933-05:00","closed_at":"2025-12-23T16:07:51.831010805-05:00","labels":["component","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.3","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:11.72446515-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.4","title":"Add application_id FK to job_stream table","description":"Create migration to add application_id foreign key to job_stream table.\n\nFile: supabase/migrations/20241223000011_add_application_id_to_job_stream.sql\n\nChanges:\n- Add application_id BIGINT column (nullable)\n- Add foreign key constraint to job_applications(application_id)\n- Add index on application_id for query performance\n\nThis allows tracking which jobs in the stream have been added to the user's application tracker.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:17.378083612-05:00","updated_at":"2025-12-23T16:07:51.846238744-05:00","closed_at":"2025-12-23T16:07:51.846244946-05:00","labels":["database","migration"],"dependencies":[{"issue_id":"ArcataAI-eh7.4","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:17.379135841-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.5","title":"Create job detail types and data fetching hook","description":"Create TypeScript types and Supabase data fetching for job details.\n\nFiles:\n- apps/hq/src/routes/jobs/types.ts - Full JobDetail type\n- apps/hq/src/routes/jobs/useJobDetail.ts - React hook for fetching\n\nJobDetail type should include all fields from jobs table:\n- jobId, companyId, title, description, location\n- jobType, category, experienceLevel, educationLevel\n- salaryMin, salaryMax, salaryCurrency\n- qualifications, preferredQualifications, responsibilities\n- sourceUrl, applicationUrl, isRemote\n- postedDate, closingDate\n- companyName (joined from companies table)\n\nuseJobDetail hook:\n- Takes jobId: number | null\n- Fetches from Supabase with company join\n- Returns { data, isLoading, error }\n- Uses Supabase JS client (RLS enabled)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:25.667855148-05:00","updated_at":"2025-12-23T16:11:11.979232379-05:00","closed_at":"2025-12-23T16:11:11.979239383-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.5","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:25.66886285-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.6","title":"Rewrite JobDetailPanel component with new design","description":"Rewrite the JobDetailPanel component with the new design layout.\n\nFile: apps/hq/src/routes/jobs/JobDetailPanel.tsx\n\nLayout:\n\n [Company Name]                                      \n [Job Title]                        [ Track] [X]   \n\n [] Category    [] Location    [] Job URL    \n\n Description                                         \n [text... More]                                      \n                                                     \n Qualifications                                      \n  item 1                                            \n  item 2                                            \n                                                     \n Responsibilities                                    \n  item 1                                            \n  item 2                                            \n\n\nFeatures:\n- Track button: FiyaIcon (flame) + 'Track' label (top right)\n- Skeleton loading state while fetching\n- Description with expandable 'More' for long text\n- Qualifications as bullet list\n- Responsibilities as bullet list\n- Metadata row: Category, Location, Job URL link\n- Close button (X)\n\nStates:\n- Loading: Skeleton UI\n- Loaded: Full content\n- Tracked: Track button disabled, shows 'Tracked'\n\ni18n: Add all text to locales/en.json","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:36.461446465-05:00","updated_at":"2025-12-23T16:16:25.017143174-05:00","closed_at":"2025-12-23T16:16:25.017152673-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.6","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:36.462340675-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.6","depends_on_id":"ArcataAI-eh7.3","type":"blocks","created_at":"2025-12-23T15:59:29.482990028-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.6","depends_on_id":"ArcataAI-eh7.5","type":"blocks","created_at":"2025-12-23T15:59:29.496772674-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.7","title":"Update HQ.tsx to use new JobDetailPanel","description":"Update HQ.tsx to properly integrate with the new JobDetailPanel.\n\nFile: apps/hq/src/routes/hq/HQ.tsx\n\nChanges:\n- Remove hardcoded panelJobData state\n- Pass only jobId to JobDetailPanel (panel fetches its own data)\n- Panel handles its own loading state\n- After tracking success, refresh the kanban/applications query\n- Wrap app with ToastProvider if not already done at root level","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:43.171898034-05:00","updated_at":"2025-12-23T16:16:25.047259539-05:00","closed_at":"2025-12-23T16:16:25.047266984-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.7","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:43.173235691-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.7","depends_on_id":"ArcataAI-eh7.1","type":"blocks","created_at":"2025-12-23T15:59:29.509747519-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.7","depends_on_id":"ArcataAI-eh7.6","type":"blocks","created_at":"2025-12-23T15:59:29.522370476-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.8","title":"Create useTrackJob hook","description":"Create a React hook for tracking jobs (adding to application board).\n\nFile: apps/hq/src/routes/jobs/useTrackJob.ts\n\nHook signature:\nuseTrackJob() =\u003e {\n  trackJob: (jobId: number, streamId: number) =\u003e Promise\u003cvoid\u003e,\n  isTracking: boolean\n}\n\nLogic:\n1. Query application_statuses for current user, order by status_order, get first\n2. Insert into job_applications with status_id, job_id, profile_id\n3. Update job_stream set application_id = new application ID\n4. Return success/throw error\n\nUses Supabase JS client (RLS - user manages their own data).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:50.867430743-05:00","updated_at":"2025-12-23T16:11:11.992449143-05:00","closed_at":"2025-12-23T16:11:11.992457329-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.8","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:50.868368117-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.8","depends_on_id":"ArcataAI-eh7.4","type":"blocks","created_at":"2025-12-23T15:59:29.535501657-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-eh7.9","title":"Wire up Track button in JobDetailPanel","description":"Connect the Track button in JobDetailPanel to useTrackJob hook.\n\nFile: apps/hq/src/routes/jobs/JobDetailPanel.tsx\n\nBehavior:\n- Track button calls trackJob(jobId, streamId)\n- Shows Spinner while isTracking is true\n- On success: show success toast, close panel\n- On error: show error toast, keep panel open\n- If already tracked (application_id exists): button disabled, shows 'Tracked'\n\nButton states:\n- Default: FiyaIcon + 'Track' (enabled)\n- Loading: Spinner + 'Track' (disabled)\n- Tracked: FiyaIcon + 'Tracked' (disabled, different style)\n\ni18n: Add toast messages to locales/en.json","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:58:58.04292082-05:00","updated_at":"2025-12-23T16:16:25.032215374-05:00","closed_at":"2025-12-23T16:16:25.032222117-05:00","labels":["feature","frontend"],"dependencies":[{"issue_id":"ArcataAI-eh7.9","depends_on_id":"ArcataAI-eh7","type":"parent-child","created_at":"2025-12-23T15:58:58.043769691-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.9","depends_on_id":"ArcataAI-eh7.8","type":"blocks","created_at":"2025-12-23T15:59:29.548154643-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.9","depends_on_id":"ArcataAI-eh7.2","type":"blocks","created_at":"2025-12-23T15:59:29.561255265-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-eh7.9","depends_on_id":"ArcataAI-eh7.1","type":"blocks","created_at":"2025-12-23T15:59:29.574037814-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-fen","title":"Add architecture diagram maintenance rule to AGENTS.md","description":"Add section to AGENTS.md instructing AI agents to keep architecture diagrams in sync when modifying system topology. Reference docs/architecture.md and apps/api/README.md diagrams.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-22T18:40:12.528576224-05:00","updated_at":"2025-12-22T18:42:50.802277545-05:00","closed_at":"2025-12-22T18:42:50.802277545-05:00"}
{"id":"ArcataAI-l49","title":"Refactor domain models to use SnakePickle for automatic snake_case conversion","description":"## Problem\n\nCurrently, each domain model (Company, Job, JobStreamEntry, JobApplication) has a verbose custom `ReadWriter` that manually maps each field between camelCase (Scala) and snake_case (Supabase/PostgreSQL). This is error-prone, hard to maintain, and duplicates logic.\n\n## Solution\n\nUse uPickle's built-in `objectAttributeKeyReadMap` and `objectAttributeKeyWriteMap` hooks to create a custom `SnakePickle` object that automatically handles the conversion.\n\n## Implementation\n\n### 1. Create SnakePickle utility\nLocation: `apps/api/src/main/scala/arcata/api/json/SnakePickle.scala`\n\n```scala\npackage arcata.api.json\n\nobject SnakePickle extends upickle.AttributeTagged {\n  // camelCase -\u003e snake_case\n  private def camelToSnake(s: String): String = {\n    s.replaceAll(\"([A-Z])\", \"_$1\").toLowerCase.stripPrefix(\"_\")\n  }\n  \n  // snake_case -\u003e camelCase\n  private def snakeToCamel(s: String): String = {\n    val parts = s.split(\"_\", -1)\n    if (parts.isEmpty) s\n    else parts.head + parts.tail.map(_.capitalize).mkString\n  }\n\n  override def objectAttributeKeyReadMap(s: CharSequence): CharSequence =\n    snakeToCamel(s.toString)\n    \n  override def objectAttributeKeyWriteMap(s: CharSequence): CharSequence =\n    camelToSnake(s.toString)\n}\n```\n\n### 2. Update domain models\nRemove custom ReadWriter implementations, use `derives SnakePickle.ReadWriter`:\n\n```scala\npackage arcata.api.domain\n\nimport arcata.api.json.SnakePickle.{ReadWriter, macroRW}\n\nfinal case class Company(\n  companyId: Option[Long] = None,\n  companyName: Option[String] = None,\n  // ... other fields\n)\n\nobject Company:\n  given ReadWriter[Company] = macroRW\n```\n\n### 3. Update SupabaseClient\nImport SnakePickle instead of upickle.default:\n\n```scala\nimport arcata.api.json.SnakePickle.{read, write}\n// Instead of: import upickle.default.*\n```\n\n### 4. Keep upickle.default for non-Supabase JSON\nSome models (ExtractedJobData, ExtractedCompanyData) are used with BoogieLoops AI which expects camelCase. These should continue using `upickle.default`.\n\n## Files to modify\n\n1. **Create**: `apps/api/src/main/scala/arcata/api/json/SnakePickle.scala`\n2. **Simplify**: `apps/api/src/main/scala/arcata/api/domain/Company.scala`\n3. **Simplify**: `apps/api/src/main/scala/arcata/api/domain/Job.scala`\n4. **Simplify**: `apps/api/src/main/scala/arcata/api/domain/JobStreamEntry.scala`\n5. **Simplify**: `apps/api/src/main/scala/arcata/api/domain/JobApplication.scala`\n6. **Update**: `apps/api/src/main/scala/arcata/api/clients/SupabaseClient.scala`\n\n## Benefits\n- ~200 lines of boilerplate removed\n- Single source of truth for case conversion\n- New fields automatically handled\n- Less error-prone\n- Easier to add new domain models\n\n## Testing\n- Ensure all existing tests pass\n- Verify Company insert returns companyId\n- Verify Job insert returns jobId\n- End-to-end test of job ingestion pipeline\n\n## Acceptance Criteria\n- [ ] SnakePickle utility created and tested\n- [ ] All domain models simplified to use macroRW\n- [ ] SupabaseClient uses SnakePickle for Supabase models\n- [ ] All 53 tests pass\n- [ ] Job ingestion pipeline works end-to-end","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:49:33.093694863-05:00","updated_at":"2025-12-23T14:49:33.093694863-05:00","labels":["api","refactor"]}
{"id":"ArcataAI-lbq","title":"Remove docs/plans/ directory","description":"Delete the docs/plans/ directory. Planning now lives in bd CLI. Remove 2025-12-22-migration-to-arcata-ai.md and the plans/ folder.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-22T18:39:59.689120305-05:00","updated_at":"2025-12-22T18:40:42.482487766-05:00","closed_at":"2025-12-22T18:40:42.482487766-05:00"}
{"id":"ArcataAI-rag","title":"Fix Scala compilation errors in API","description":"The API fails to compile with 11 errors after the recent ETL rework.\n\n## Errors:\n\n1. **ProgressEmitter syntax in for-comprehension** (JobIngestionPipeline.scala:81,123)\n   - `_ = progressEmitter.emit(...)` invalid in Scala 3 for-comprehension\n\n2. **SchemaError import not found** (JobExtractionAgent.scala:7, CompanyEnrichmentAgent.scala:7)\n   - `boogieloops.schema.SchemaError` doesn't exist\n\n3. **.message not a member of Any** (JobParser.scala:53, CompanyResolver.scala:82)\n   - Error types inferred as Any","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T09:32:18.94705359-05:00","updated_at":"2025-12-24T11:36:40.703477131-05:00","closed_at":"2025-12-24T11:36:40.703477131-05:00"}
{"id":"ArcataAI-rag.1","title":"Fix ProgressEmitter calls in for-comprehension","description":"Lines 81 and 123 use invalid syntax `_ = progressEmitter.emit(...)`. Move emit calls outside the for-comprehension.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T09:32:25.702125355-05:00","updated_at":"2025-12-24T11:36:40.715577734-05:00","closed_at":"2025-12-24T11:36:40.715577734-05:00","dependencies":[{"issue_id":"ArcataAI-rag.1","depends_on_id":"ArcataAI-rag","type":"parent-child","created_at":"2025-12-23T09:32:25.703180902-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-rag.2","title":"Fix SchemaError import in AI agents","description":"Import `boogieloops.schema.SchemaError` doesn't exist. Find correct error type from BoogieLoops AI library.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T09:32:25.717690104-05:00","updated_at":"2025-12-24T11:36:40.727041709-05:00","closed_at":"2025-12-24T11:36:40.727041709-05:00","dependencies":[{"issue_id":"ArcataAI-rag.2","depends_on_id":"ArcataAI-rag","type":"parent-child","created_at":"2025-12-23T09:32:25.718335928-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-rag.3","title":"Fix .message access on Any type","description":"In JobParser.scala:53 and CompanyResolver.scala:82, error types are inferred as Any. Add type annotations or use toString.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T09:32:25.73201289-05:00","updated_at":"2025-12-24T11:36:40.737920078-05:00","closed_at":"2025-12-24T11:36:40.737920078-05:00","dependencies":[{"issue_id":"ArcataAI-rag.3","depends_on_id":"ArcataAI-rag","type":"parent-child","created_at":"2025-12-23T09:32:25.732614919-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-vms","title":"Fix Supabase JWT authentication - invalid service role key format","description":"SupabaseClient sends invalid JWT to Supabase. Error: Expected 3 parts in JWT; got 1. The service role key may not be loaded correctly from env.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-23T13:23:58.38350008-05:00","updated_at":"2025-12-23T13:23:58.38350008-05:00"}
{"id":"ArcataAI-xzo","title":"Config-Driven Job Extraction System","description":"Replace monolithic HTML cleaner with a config-driven extraction system that learns and improves over time.\n\n## Vision\n- Extraction configs define how to find and map job data from HTML\n- Configs are matched to pages via patterns (CSS selectors, URL patterns)\n- When no config matches, AI generates a new config\n- AI refines configs in a retry loop (up to 3 attempts) until extraction is complete/sufficient\n- Configs are saved to database for deterministic future extractions\n\n## Key Properties\n1. Starts dumb, gets smarter - Initially relies on AI, learns deterministic configs over time\n2. Config as knowledge - Database of configs becomes institutional knowledge\n3. Efficiency compounds - More jobs = more configs = less AI needed\n4. Human-auditable - Configs are inspectable, not black-box AI\n\n## Architecture\nSee docs/plans/ for detailed architecture diagrams\n\n## Success Criteria\n- Netflix job URL extracts complete job data (title, description, salary, qualifications)\n- System saves working configs to database\n- Future Netflix jobs use saved config (no AI needed)\n- Partial extractions are saved with appropriate CompletionState","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-24T09:55:35.415677926-05:00","updated_at":"2025-12-24T11:36:19.30584099-05:00","closed_at":"2025-12-24T11:36:19.30584099-05:00"}
{"id":"ArcataAI-xzo.1","title":"Define CompletionState enum and scoring system","description":"Create the CompletionState enum and weighted scoring system for evaluating extraction quality.\n\n## CompletionState Enum\n```scala\nenum CompletionState:\n  case Complete    // 90%+ score - all weighted fields extracted\n  case Sufficient  // 70-90% score - required + enough optional\n  case Partial     // 50-70% score - some fields, missing important ones\n  case Minimal     // \u003c50% but has required - title, company only\n  case Failed      // Missing required fields\n```\n\n## Weighted Scoring\n| Field | Weight | Required |\n|-------|--------|----------|\n| title | 20 | Yes |\n| company_name | 15 | Yes |\n| description | 25 | Yes |\n| location | 10 | No |\n| salary_min/max | 10 | No |\n| qualifications | 5 | No |\n| responsibilities | 5 | No |\n| benefits | 5 | No |\n| job_type | 3 | No |\n| experience_level | 2 | No |\n\n## Validation Rules\n- Required fields must be non-empty\n- Fields must have min_length \u003e 4-5 chars (not too rigid)\n- Score = sum of weights for extracted fields / total possible\n\n## Files to Create\n- `apps/api/src/main/scala/arcata/api/extraction/CompletionState.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/CompletionScorer.scala`\n\n## Tests\n- Test scoring with various field combinations\n- Test threshold boundaries (89% vs 90%, etc.)\n- Test empty/whitespace handling","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:55:47.387264197-05:00","updated_at":"2025-12-24T10:20:30.764607847-05:00","closed_at":"2025-12-24T10:20:30.764607847-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.1","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:55:47.387898686-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.10","title":"Create seed config for Schema.org JSON-LD JobPosting","description":"Create a default extraction config for pages with Schema.org JSON-LD JobPosting data.\n\n## Why\nMany job sites (Netflix, LinkedIn, Indeed) include Schema.org structured data.\nThis is the most reliable extraction source when present.\n\n## Config\n```yaml\nname: 'Schema.org JSON-LD JobPosting'\nversion: 1\ncreated_by: 'manual'\n\nmatch:\n  - type: css_exists\n    selector: \"script[type='application/ld+json']\"\n    content_contains: 'JobPosting'\n\nextract:\n  title:\n    - source: jsonld\n      path: $.title\n  \n  description:\n    - source: jsonld\n      path: $.description\n      transform: html_decode\n  \n  company_name:\n    - source: jsonld\n      path: $.hiringOrganization.name\n  \n  location:\n    - source: jsonld\n      path: $.jobLocation[0].address.addressLocality\n    - source: jsonld\n      path: $.jobLocation.address.addressLocality\n  \n  salary_min:\n    - source: jsonld\n      path: $.baseSalary.value.minValue\n    - source: jsonld\n      path: $.baseSalary.minValue\n  \n  salary_max:\n    - source: jsonld\n      path: $.baseSalary.value.maxValue\n    - source: jsonld\n      path: $.baseSalary.maxValue\n  \n  salary_currency:\n    - source: jsonld\n      path: $.baseSalary.currency\n  \n  job_type:\n    - source: jsonld\n      path: $.employmentType\n  \n  posted_date:\n    - source: jsonld\n      path: $.datePosted\n  \n  closing_date:\n    - source: jsonld\n      path: $.validThrough\n  \n  application_url:\n    - source: jsonld\n      path: $.url\n```\n\n## Deliverable\n- Create migration to insert seed config\n- Or: Create seed SQL file\n- Test against Netflix URL","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:57:59.39554768-05:00","updated_at":"2025-12-24T11:36:19.282368547-05:00","closed_at":"2025-12-24T11:36:19.282368547-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.10","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:57:59.396192549-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.10","depends_on_id":"ArcataAI-xzo.7","type":"blocks","created_at":"2025-12-24T09:58:27.860038332-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.11","title":"Add completion_state column to jobs table","description":"Track the extraction completion state for each job in the database.\n\n## Why\n- Know which jobs have complete data vs partial\n- Enable background job to retry incomplete extractions\n- Show UI indicators for data quality\n\n## Migration\n```sql\nALTER TABLE jobs\nADD COLUMN completion_state TEXT DEFAULT 'unknown';\n\nALTER TABLE jobs\nADD COLUMN extraction_config_id UUID REFERENCES extraction_configs(id);\n\nCREATE INDEX idx_jobs_completion_state ON jobs(completion_state);\n```\n\n## Values\n- 'complete' - All important fields extracted\n- 'sufficient' - Enough for user value\n- 'partial' - Missing some important fields\n- 'minimal' - Only basic fields\n- 'failed' - Extraction failed\n- 'unknown' - Legacy jobs before this feature\n\n## UI Considerations\n- Could show indicator on job cards\n- Could filter by completion state\n- Out of scope for this task, but consider\n\n## Files\n- `supabase/migrations/YYYYMMDD_add_job_completion_state.sql`","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:58:08.239779096-05:00","updated_at":"2025-12-24T11:36:19.293847595-05:00","closed_at":"2025-12-24T11:36:19.293847595-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.11","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:58:08.240458913-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.11","depends_on_id":"ArcataAI-xzo.8","type":"blocks","created_at":"2025-12-24T09:58:27.871210043-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.12","title":"Write architecture documentation for config-driven extraction","description":"Document the config-driven extraction system architecture.\n\n## Location\n`docs/plans/YYYY-MM-DD-config-driven-extraction.md`\n\n## Contents\n\n### Overview\n- Problem statement (Netflix missing data)\n- Solution vision (config-driven, self-improving)\n\n### Architecture Diagrams\n- Main flow diagram (from our discussion)\n- AI Config Generator detail diagram\n- Data model diagram\n\n### Config Schema\n- Full schema documentation\n- Match pattern types\n- Extract rule types\n- Transform types\n\n### Completion Scoring\n- Field weights table\n- State thresholds\n- Examples\n\n### Database Schema\n- extraction_configs table\n- Indexes\n- RLS policies\n\n### API Changes\n- New pipeline steps\n- Input/output types\n\n### Future Considerations\n- Background retry job for partial extractions\n- A/B testing configs\n- Manual config editing UI\n- Config sharing between instances\n\n## Update existing docs\n- `docs/architecture.md` - add extraction system\n- `apps/api/README.md` - update pipeline diagram","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:58:18.797799971-05:00","updated_at":"2025-12-24T11:39:54.749065102-05:00","closed_at":"2025-12-24T11:39:54.749065102-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.12","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:58:18.798403018-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.2","title":"Create extraction_configs database table and migration","description":"Create the database schema for storing extraction configs.\n\n## Schema\n```sql\nCREATE TABLE extraction_configs (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name TEXT NOT NULL,\n  version INTEGER NOT NULL DEFAULT 1,\n  \n  -- Matching\n  match_patterns JSONB NOT NULL,  -- Array of match rules\n  match_hash TEXT NOT NULL,       -- Hash of patterns for quick lookup\n  \n  -- Extraction rules\n  extract_rules JSONB NOT NULL,\n  \n  -- Metadata\n  completion_state TEXT NOT NULL DEFAULT 'unknown',\n  times_used INTEGER DEFAULT 0,\n  times_succeeded INTEGER DEFAULT 0,\n  last_used_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW(),\n  created_by TEXT,  -- 'ai' or 'manual'\n  \n  -- For debugging/improvement\n  sample_url TEXT,\n  sample_extraction JSONB,\n  \n  UNIQUE(match_hash, version)\n);\n\nCREATE INDEX idx_extraction_configs_match_hash ON extraction_configs(match_hash);\nCREATE INDEX idx_extraction_configs_completion ON extraction_configs(completion_state);\n```\n\n## RLS Policies\n- Service role can read/write all configs\n- Authenticated users can read configs (for transparency)\n- Only service role can create/update\n\n## Files\n- `supabase/migrations/YYYYMMDD_create_extraction_configs.sql`\n\n## Considerations\n- match_hash should be deterministic (sorted, normalized)\n- JSONB columns for flexibility\n- version field for A/B testing later","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:55:58.80524536-05:00","updated_at":"2025-12-24T10:21:21.58050855-05:00","closed_at":"2025-12-24T10:21:21.58050855-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.2","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:55:58.806143654-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.3","title":"Define ExtractionConfig domain model and JSON schema","description":"Create the Scala domain model for extraction configs with JSON serialization.\n\n## Config Schema Structure\n```yaml\nid: uuid\nname: string\nversion: integer\n\nmatch:  # 1 or more patterns (all must match)\n  - type: css_exists | url_pattern | content_contains\n    selector: string (for css_exists)\n    pattern: string (for url_pattern, content_contains)\n    content_contains: string (optional, for css_exists)\n\nextract:  # Field extraction rules\n  \u003cfield_name\u003e:\n    - source: jsonld | css | meta | regex\n      path: string (JSONPath for jsonld)\n      selector: string (CSS selector)\n      name: string (meta tag name)\n      pattern: string (regex with capture group)\n      transform: html_decode | inner_html | inner_text | regex:\u003cpattern\u003e | parse_number | split:\u003cdelim\u003e:\u003cidx\u003e | json_parse\n```\n\n## Scala Models\n```scala\ncase class ExtractionConfig(\n  id: UUID,\n  name: String,\n  version: Int,\n  matchPatterns: Seq[MatchPattern],\n  extractRules: Map[String, Seq[ExtractRule]],\n  completionState: CompletionState,\n  timesUsed: Int,\n  timesSucceeded: Int,\n  createdBy: String,\n  sampleUrl: Option[String]\n)\n\nsealed trait MatchPattern\ncase class CssExists(selector: String, contentContains: Option[String]) extends MatchPattern\ncase class UrlPattern(pattern: String) extends MatchPattern\ncase class ContentContains(pattern: String) extends MatchPattern\n\nsealed trait ExtractRule\ncase class JsonLdRule(path: String, transform: Option[Transform]) extends ExtractRule\ncase class CssRule(selector: String, transform: Option[Transform]) extends ExtractRule\ncase class MetaRule(name: String, transform: Option[Transform]) extends ExtractRule\ncase class RegexRule(selector: String, pattern: String, transform: Option[Transform]) extends ExtractRule\n\nenum Transform:\n  case HtmlDecode\n  case InnerHtml\n  case InnerText\n  case Regex(pattern: String)\n  case ParseNumber\n  case Split(delimiter: String, index: Int)\n  case JsonParse\n```\n\n## Files\n- `apps/api/src/main/scala/arcata/api/extraction/ExtractionConfig.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/MatchPattern.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/ExtractRule.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/Transform.scala`\n\n## JSON Serialization\n- Use upickle for serialization\n- Support reading from DB JSONB columns\n- Validate on parse (invalid configs should fail loudly)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:56:16.540081052-05:00","updated_at":"2025-12-24T10:22:48.887303883-05:00","closed_at":"2025-12-24T10:22:48.887303883-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.3","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:56:16.54071989-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.3","depends_on_id":"ArcataAI-xzo.1","type":"blocks","created_at":"2025-12-24T09:58:27.714166383-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.4","title":"Implement ConfigMatcher - find matching configs for a page","description":"Create the ConfigMatcher that finds the best matching extraction config for a given URL + HTML.\n\n## Responsibilities\n1. Load all configs from database\n2. For each config, evaluate all match patterns against URL + HTML\n3. Return configs sorted by specificity (most patterns matched first)\n4. Tie-breaker: most recent (latest updated_at)\n\n## Matching Logic\n```scala\ntrait ConfigMatcher:\n  def findMatch(url: String, html: String): Option[ExtractionConfig]\n  def findAllMatches(url: String, html: String): Seq[ExtractionConfig]\n```\n\n## Pattern Evaluation\n- **css_exists**: Use jsoup to check if selector matches any elements\n  - If content_contains specified, check element text/html contains string\n- **url_pattern**: Regex match against URL\n- **content_contains**: Check if HTML contains string (case-insensitive)\n\n## Specificity Scoring\n- Count number of patterns that must match\n- More patterns = more specific = higher priority\n- Example: config with 3 patterns beats config with 1 pattern\n\n## Caching Considerations\n- Configs don't change often - consider in-memory cache\n- Cache invalidation on config create/update\n- For now: simple DB query each time (optimize later)\n\n## Files\n- `apps/api/src/main/scala/arcata/api/extraction/ConfigMatcher.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/PatternEvaluator.scala`\n\n## Tests\n- Test each pattern type individually\n- Test specificity ordering\n- Test tie-breaker by date\n- Test no match returns None","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:56:28.602492543-05:00","updated_at":"2025-12-24T10:24:47.008592356-05:00","closed_at":"2025-12-24T10:24:47.008592356-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.4","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:56:28.603188402-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.4","depends_on_id":"ArcataAI-xzo.2","type":"blocks","created_at":"2025-12-24T09:58:27.725743396-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.4","depends_on_id":"ArcataAI-xzo.3","type":"blocks","created_at":"2025-12-24T09:58:27.737668728-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.5","title":"Implement DeterministicExtractor - apply config to extract data","description":"Create the DeterministicExtractor that applies an ExtractionConfig to HTML and returns structured job data.\n\n## Responsibilities\n1. Take ExtractionConfig + HTML as input\n2. For each field in extract_rules, try each rule in order\n3. First rule that produces non-empty result wins\n4. Apply transforms to extracted values\n5. Return ExtractedJobData + CompletionState\n\n## Extraction Sources\n\n### jsonld\n- Find all `\u003cscript type=\"application/ld+json\"\u003e` tags\n- Parse JSON, find object with `@type: JobPosting`\n- Use **JsonPathTraverser** (created in xzo.9) to extract value\n\n### css\n- Use jsoup to select elements\n- Get text content or innerHTML based on transform\n\n### meta\n- Find `\u003cmeta name=\"X\"\u003e` or `\u003cmeta property=\"X\"\u003e`\n- Return content attribute value\n\n### regex\n- Select element with CSS selector (or use whole document)\n- Apply regex pattern, return first capture group\n\n## Transform Pipeline\nEach transform modifies the extracted value:\n- **html_decode**: Decode \u0026amp;  \u0026, etc.\n- **inner_html**: Get innerHTML (default for css)\n- **inner_text**: Get text only, strip tags\n- **regex:\u003cpattern\u003e**: Apply regex, return first capture\n- **parse_number**: Remove non-numeric, parse to number\n- **split:\u003cdelim\u003e:\u003cidx\u003e**: Split string, return nth element\n- **json_parse**: Parse as JSON (for embedded JSON strings)\n\n## Interface\n```scala\ntrait DeterministicExtractor:\n  def extract(config: ExtractionConfig, html: String, url: String): ExtractionResult\n\ncase class ExtractionResult(\n  data: ExtractedJobData,\n  completionState: CompletionState,\n  score: Double,\n  missingFields: Seq[String],\n  extractedFields: Map[String, String]  // For debugging\n)\n```\n\n## Dependencies\n- JsonPathTraverser (completed in xzo.9)\n- CompletionState and scoring (xzo.1)\n- ExtractionConfig domain models (xzo.3)\n\n## Files\n- `apps/api/src/main/scala/arcata/api/extraction/DeterministicExtractor.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/SourceExtractor.scala` (jsonld, css, meta, regex)\n- `apps/api/src/main/scala/arcata/api/extraction/TransformPipeline.scala`\n\n## Tests\n- Test each source type\n- Test each transform\n- Test fallback (first rule fails, second succeeds)\n- Test with real Netflix HTML","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:56:47.877045503-05:00","updated_at":"2025-12-24T10:28:58.03084419-05:00","closed_at":"2025-12-24T10:28:58.03084419-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.5","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:56:47.877695052-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.5","depends_on_id":"ArcataAI-xzo.3","type":"blocks","created_at":"2025-12-24T09:58:27.749831102-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.5","depends_on_id":"ArcataAI-xzo.9","type":"blocks","created_at":"2025-12-24T09:58:27.762735065-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.6","title":"Implement AI ConfigGenerator with retry loop","description":"Create the AI-powered config generator that analyzes HTML and creates extraction configs.\n\n## Flow (see architecture diagram)\n```\nHTML + URL\n    \n    \n\n Attempt 1        \n Generate Config   AI Agent analyzes page structure\n\n         \n         \n\n Apply Config      Use DeterministicExtractor\n (extract data)   \n\n         \n         \n     \n Evaluate          Complete/Sufficient  Return\n Completeness              Config + Data\n\n         \n          (Incomplete + attempts \u003c 3)\n\n Attempt N        \n Refine Config     Context: 'Missing: description,\n with feedback          salary. Found empty at path X'\n\n         \n         \n     (loop back to Apply Config)\n\nAfter 3 attempts:\n\n Return best      \n config + data    \n with completion  \n state (may be    \n Partial/Minimal) \n\n```\n\n## AI Agent Prompt Design\n\n### Initial Generation Prompt\n- Provide: URL, HTML (truncated if needed), list of target fields\n- Ask AI to:\n  1. Identify data sources (JSON-LD, meta tags, visible content, embedded JSON)\n  2. Create match patterns that would identify this page type\n  3. Create extract rules for each target field\n  4. Return as structured ExtractionConfig JSON\n\n### Refinement Prompt\n- Provide: Previous config, extraction result, missing fields\n- Context: 'Field X was empty. The selector returned no elements.'\n- Ask AI to:\n  1. Analyze why extraction failed\n  2. Suggest alternative selectors/paths\n  3. Return updated config\n\n## Max Attempts: 3\n- Track best result across attempts\n- Return best even if not Complete\n- Always save config to DB (with appropriate completion_state)\n\n## Interface\n```scala\ntrait ConfigGenerator:\n  def generate(url: String, html: String): ConfigGenerationResult\n\ncase class ConfigGenerationResult(\n  config: ExtractionConfig,\n  data: ExtractedJobData,\n  completionState: CompletionState,\n  attempts: Int\n)\n```\n\n## Files\n- `apps/api/src/main/scala/arcata/api/extraction/ConfigGenerator.scala`\n- `apps/api/src/main/scala/arcata/api/ai/ConfigGeneratorAgent.scala`\n\n## Tests\n- Mock AI responses for testing\n- Test retry loop with improving responses\n- Test max attempts reached\n- Test saving partial results","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:57:08.268897051-05:00","updated_at":"2025-12-24T11:09:11.289258467-05:00","closed_at":"2025-12-24T11:09:11.289258467-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.6","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:57:08.269431123-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.6","depends_on_id":"ArcataAI-xzo.5","type":"blocks","created_at":"2025-12-24T09:58:27.775226983-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.7","title":"Create ExtractionConfigRepository for DB operations","description":"Create the repository for CRUD operations on extraction_configs table.\n\n## Responsibilities\n- Save new configs\n- Update existing configs (increment version)\n- Find configs by match patterns\n- Update usage stats (times_used, times_succeeded, last_used_at)\n- List configs by completion_state\n\n## Interface\n```scala\ntrait ExtractionConfigRepository:\n  def save(config: ExtractionConfig): Either[Error, ExtractionConfig]\n  def findByMatchHash(hash: String): Either[Error, Option[ExtractionConfig]]\n  def findAll(): Either[Error, Seq[ExtractionConfig]]\n  def incrementUsage(id: UUID, succeeded: Boolean): Either[Error, Unit]\n  def createNewVersion(config: ExtractionConfig): Either[Error, ExtractionConfig]\n```\n\n## Match Hash Generation\n- Deterministic hash of match patterns\n- Sort patterns before hashing\n- Use consistent JSON serialization\n- SHA-256 or similar\n\n## Version Management\n- When creating new version: copy config, increment version\n- Old versions remain in DB (for rollback/comparison)\n- findByMatchHash returns latest version only\n\n## Files\n- `apps/api/src/main/scala/arcata/api/extraction/ExtractionConfigRepository.scala`\n- `apps/api/src/main/scala/arcata/api/extraction/MatchHasher.scala`\n\n## Tests\n- Test save and retrieve\n- Test version increment\n- Test usage stats update\n- Test match hash consistency","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:57:18.097084366-05:00","updated_at":"2025-12-24T11:14:23.500903184-05:00","closed_at":"2025-12-24T11:14:23.500903184-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.7","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:57:18.097763842-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.7","depends_on_id":"ArcataAI-xzo.2","type":"blocks","created_at":"2025-12-24T09:58:27.786658832-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.7","depends_on_id":"ArcataAI-xzo.3","type":"blocks","created_at":"2025-12-24T09:58:27.798808392-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.8","title":"Integrate extraction system into JobIngestionPipeline","description":"Replace the current HtmlCleaner + JobParser with the new config-driven extraction system.\n\n## Current Pipeline\n1. HtmlFetcher - fetch raw HTML\n2. HtmlCleaner - clean and convert to Markdown\n3. JobParser - AI extraction from Markdown\n4. CompanyResolver - resolve/create company\n5. JobLoader - save to database\n6. StreamLoader - add to job stream\n7. ApplicationLoader - optionally create application\n\n## New Pipeline\n1. HtmlFetcher - fetch raw HTML (unchanged)\n2. **JobExtractor** (new) - config-driven extraction\n   - ConfigMatcher.findMatch(url, html)\n   - If match: DeterministicExtractor.extract(config, html)\n   - If no match: ConfigGenerator.generate(url, html)\n   - Save config to DB if new\n   - Returns ExtractedJobData + CompletionState\n3. CompanyResolver - resolve/create company (updated to use ExtractedJobData)\n4. JobLoader - save to database (add completion_state column?)\n5. StreamLoader - add to job stream (unchanged)\n6. ApplicationLoader - optionally create application (unchanged)\n\n## Pipeline Step Interface\n```scala\ncase class JobExtractorInput(\n  html: String,\n  url: String,\n  objectId: Option[String]\n)\n\ncase class JobExtractorOutput(\n  extractedData: ExtractedJobData,\n  completionState: CompletionState,\n  configId: UUID,  // Config that was used\n  configWasGenerated: Boolean  // True if AI generated new config\n)\n```\n\n## Migration Considerations\n- Keep old HtmlCleaner/JobParser temporarily for comparison?\n- Feature flag to switch between old and new?\n- Or just replace entirely?\n\n## Files to Modify\n- `apps/api/src/main/scala/arcata/api/etl/JobIngestionPipeline.scala`\n- `apps/api/src/main/scala/arcata/api/etl/steps/JobExtractor.scala` (new, replaces HtmlCleaner + JobParser)\n\n## Tests\n- Integration test with real Netflix URL\n- Test config matching path\n- Test config generation path\n- Verify all pipeline steps still work","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-24T09:57:32.31187679-05:00","updated_at":"2025-12-24T11:36:14.92683625-05:00","closed_at":"2025-12-24T11:36:14.92683625-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.8","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:57:32.312544754-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.8","depends_on_id":"ArcataAI-xzo.4","type":"blocks","created_at":"2025-12-24T09:58:27.813559731-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.8","depends_on_id":"ArcataAI-xzo.5","type":"blocks","created_at":"2025-12-24T09:58:27.826247912-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.8","depends_on_id":"ArcataAI-xzo.6","type":"blocks","created_at":"2025-12-24T09:58:27.837916884-05:00","created_by":"daemon"},{"issue_id":"ArcataAI-xzo.8","depends_on_id":"ArcataAI-xzo.7","type":"blocks","created_at":"2025-12-24T09:58:27.848442343-05:00","created_by":"daemon"}]}
{"id":"ArcataAI-xzo.9","title":"Research: upickle vs json-path for JSONPath queries","description":"Determine the best approach for extracting values from JSON-LD using JSONPath expressions.\n\n## Context\nJSON-LD in job pages contains structured data like:\n```json\n{\n  \"@type\": \"JobPosting\",\n  \"title\": \"Software Engineer\",\n  \"hiringOrganization\": {\n    \"name\": \"Netflix\"\n  },\n  \"baseSalary\": {\n    \"value\": {\n      \"minValue\": 100000,\n      \"maxValue\": 720000\n    }\n  }\n}\n```\n\nWe need to extract values using paths like:\n- `$.title`\n- `$.hiringOrganization.name`\n- `$.baseSalary.value.minValue`\n\n## Options\n\n### Option A: upickle with manual path traversal\n- Already a dependency\n- Parse JSON to ujson.Value\n- Write simple path traversal: `json(\"baseSalary\")(\"value\")(\"minValue\")`\n- Pro: No new dependency\n- Con: Not full JSONPath spec (no wildcards, filters)\n\n### Option B: jayway/json-path library\n- `com.jayway:json-path:2.9.0`\n- Full JSONPath spec support\n- Pro: Standard JSONPath syntax\n- Con: New dependency, Java library\n\n### Option C: Custom mini JSONPath parser\n- Support subset: `$.foo.bar[0].baz`\n- Use upickle for JSON parsing\n- Pro: No dependency, full control\n- Con: More code to write/maintain\n\n## Recommendation\nStart with Option A (upickle manual traversal) for simplicity.\nIf we need advanced JSONPath features later, add json-path.\n\n## Deliverable\n- Document decision\n- Create utility function for path extraction\n- Add tests for common path patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:57:47.281263842-05:00","updated_at":"2025-12-24T10:12:37.069307257-05:00","closed_at":"2025-12-24T10:12:37.069307257-05:00","dependencies":[{"issue_id":"ArcataAI-xzo.9","depends_on_id":"ArcataAI-xzo","type":"parent-child","created_at":"2025-12-24T09:57:47.281873973-05:00","created_by":"daemon"}]}
